*&---------------------------------------------------------------------*
*& Report ZMWSCAN
*&---------------------------------------------------------------------*
*&
*&---------------------------------------------------------------------*
REPORT zmwscan.

DATA client      TYPE REF TO if_http_client.
DATA mwscan TYPE REF TO zcl_mwscan_client.

cl_http_client=>create_by_destination(
  EXPORTING
    destination                = 'MWSCAN'
  IMPORTING
    client                     = client
*  EXCEPTIONS
*    argument_not_found         = 1
*    destination_not_found      = 2
*    destination_no_authority   = 3
*    plugin_not_active          = 4
*    internal_error             = 5
*    oa2c_set_token_error       = 6
*    oa2c_missing_authorization = 7
*    oa2c_invalid_config        = 8
*    oa2c_invalid_parameters    = 9
*    oa2c_invalid_scope         = 10
*    oa2c_invalid_grant         = 11
*    others                     = 12
       ).
IF sy-subrc <> 0.
* Implement suitable error handling here
ENDIF.


CREATE OBJECT mwscan
  EXPORTING
    ii_client = client
*   iv_uri_prefix = iv_uri_prefix
*   it_extra_headers = it_extra_headers
*   iv_timeout = IF_HTTP_CLIENT=>CO_TIMEOUT_DEFAULT
  .

DATA(return) = mwscan->zif_mwscan_interface~returns_information_about_th( ).

WRITE: / 'SIGNATURETIMESTAMP'.
WRITE: / return-_200_app_json-signaturetimestamp.
WRITE: / ''.

DATA: data_to_scan_string TYPE string VALUE 'X5O!P%@AP[4\PZX54(P^)7CC)7}$EICAR-STANDARD-ANTIVIRUS-TEST-FILE!$H+H*'.
DATA: data_to_scan TYPE xstring.

CALL FUNCTION 'SCMS_STRING_TO_XSTRING'
  EXPORTING
    text   = data_to_scan_string
  IMPORTING
    buffer = data_to_scan.

data_to_scan = data_to_scan_string.

DATA(return_scan) = mwscan->zif_mwscan_interface~scans_a_file_for_malware_( cdata_to_scan = data_to_scan_string ).
"DATA(return_scan) = mwscan->zif_mwscan_interface~scans_a_file_for_malware_( data_to_scan = data_to_scan ).

WRITE: / 'Scan result'.
WRITE: / ''.
WRITE: / 'Malware Detected'.
WRITE: / return_scan-_200_app_json-malwaredetected.
WRITE: / 'Finding'.
WRITE: / return_scan-_200_app_json-finding.
WRITE: / 'Mimetype'.
WRITE: / return_scan-_200_app_json-mimetype.
